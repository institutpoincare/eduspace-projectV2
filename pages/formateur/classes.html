<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mes Classes - EduSpace Formateur</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            blue: { 50: "#eff6ff", 100: "#dbeafe", 500: "#3b82f6", 600: "#2563eb", 700: "#1d4ed8" },
          },
          fontFamily: { sans: ["Plus Jakarta Sans", "sans-serif"] },
        },
      },
    };
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../../css/main.css" />
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    body { background-color: #f8fafc; font-family: 'Plus Jakarta Sans', sans-serif; }
    
    .premium-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }
    .premium-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    .tab-btn {
        position: relative;
    }
    .tab-btn.active {
       color: #2563eb;
    }
    .tab-btn.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: #2563eb;
        border-radius: 3px 3px 0 0;
    }
    
    /* Animations */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-enter { animation: fadeIn 0.4s ease-out forwards; }
    
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 overflow-x-hidden">
  <div class="flex min-h-screen relative">
    <div id="sidebar-container" class="fixed top-0 left-0 h-full w-[280px] z-30 transition-transform duration-300"></div>

    <main id="main-content" class="flex-1 p-6 ml-[280px] min-h-screen flex flex-col transition-all duration-300">
      <!-- Header -->
      <header class="flex justify-between items-center mb-8 animate-enter">
        <div>
          <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Gestion des Classes</h1>
          <p class="text-gray-500 mt-1 font-medium">Gérez vos cohortes, élèves et ressources.</p>
        </div>
        <button onclick="openCreateModal()" class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 flex items-center gap-2 font-bold shadow-lg shadow-blue-200 transition-all hover:scale-105 active:scale-95">
          <i data-lucide="plus-circle" class="w-5 h-5"></i> Créer une Classe
        </button>
      </header>

      <!-- Stats Grid -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 animate-enter" style="animation-delay: 0.1s">
        <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex justify-between items-start mb-4">
                <div class="p-3 bg-blue-50 text-blue-600 rounded-2xl"><i data-lucide="layers" class="w-6 h-6"></i></div>
                <span class="text-xs font-bold px-2 py-1 bg-gray-100 text-gray-600 rounded-lg">Total</span>
            </div>
            <h3 class="text-3xl font-bold text-gray-900" id="stat-total-classes">0</h3>
            <p class="text-sm text-gray-500 mt-1">Classes actives</p>
        </div>
        <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
             <div class="flex justify-between items-start mb-4">
                <div class="p-3 bg-green-50 text-green-600 rounded-2xl"><i data-lucide="users" class="w-6 h-6"></i></div>
                <span class="text-xs font-bold px-2 py-1 bg-green-100 text-green-700 rounded-lg">+12%</span>
            </div>
            <h3 class="text-3xl font-bold text-gray-900" id="stat-total-students">0</h3>
            <p class="text-sm text-gray-500 mt-1">Étudiants inscrits</p>
        </div>
        <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
             <div class="flex justify-between items-start mb-4">
                <div class="p-3 bg-purple-50 text-purple-600 rounded-2xl"><i data-lucide="dollar-sign" class="w-6 h-6"></i></div>
            </div>
            <h3 class="text-3xl font-bold text-gray-900" id="stat-revenue">0 TND</h3>
            <p class="text-sm text-gray-500 mt-1">Objectif: 0 TND</p>
        </div>
        <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
             <div class="flex justify-between items-start mb-4">
                <div class="p-3 bg-orange-50 text-orange-600 rounded-2xl"><i data-lucide="trending-up" class="w-6 h-6"></i></div>
            </div>
            <h3 class="text-3xl font-bold text-gray-900" id="stat-payment-rate">0%</h3>
            <p class="text-sm text-gray-500 mt-1">Taux de recouvrement</p>
        </div>
      </div>

      <!-- Main Section -->
      <div class="bg-white rounded-3xl border border-gray-200 shadow-xl shadow-gray-100/50 p-8 min-h-[500px] animate-enter" style="animation-delay: 0.2s">
        <!-- Tabs -->
        <div class="flex items-center gap-8 border-b border-gray-100 mb-8 overflow-x-auto no-scrollbar">
            <button onclick="switchTab('classes')" id="tab-classes" class="tab-btn active pb-4 text-sm font-bold text-gray-500 hover:text-blue-600 transition-colors whitespace-nowrap">
                Mes Classes
            </button>
            <button onclick="switchTab('requests')" id="tab-requests" class="tab-btn pb-4 text-sm font-bold text-gray-500 hover:text-blue-600 transition-colors whitespace-nowrap flex items-center gap-2">
                Demandes d'inscription
                <span class="bg-red-500 text-white text-[10px] px-1.5 py-0.5 rounded-full hidden">0</span>
            </button>
             <button onclick="switchTab('payments')" id="tab-payments" class="tab-btn pb-4 text-sm font-bold text-gray-500 hover:text-blue-600 transition-colors whitespace-nowrap">
                Suivi des Paiements
            </button>
        </div>

        <!-- Contents -->
        <div id="content-classes" class="tab-content grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6">
            <div id="classes-list" class="contents"></div>
        </div>

        <div id="content-requests" class="tab-content hidden max-w-4xl">
             <div id="requests-list" class="space-y-4"></div>
        </div>

        <div id="content-payments" class="tab-content hidden">
            <div class="overflow-x-auto rounded-xl border border-gray-100">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 text-gray-500 text-sm font-bold uppercase">
                        <tr>
                            <th class="px-6 py-4">Étudiant</th>
                            <th class="px-6 py-4">Classe</th>
                            <th class="px-6 py-4">Prix</th>
                            <th class="px-6 py-4">Payé</th>
                            <th class="px-6 py-4">Reste</th>
                            <th class="px-6 py-4">Statut</th>
                            <th class="px-6 py-4 text-right">Action</th>
                        </tr>
                    </thead>
                    <tbody id="payments-list" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Create Modal -->
  <div id="create-modal" class="fixed inset-0 z-50 bg-gray-900/60 hidden flex items-center justify-center backdrop-blur-sm px-4">
      <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col animate-[scaleIn_0.2s_ease-out]">
          <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
              <h3 id="modal-title" class="text-xl font-bold text-gray-900">Nouvelle Classe</h3>
              <button onclick="closeModal()" class="p-2 hover:bg-gray-200 rounded-full text-gray-500"><i data-lucide="x" class="w-5 h-5"></i></button>
          </div>
          
          <div class="p-8 overflow-y-auto custom-scrollbar space-y-8">
              <!-- Basic Info -->
              <div class="space-y-4">
                  <div>
                      <label class="block text-sm font-bold text-gray-700 mb-2">Nom de la classe</label>
                      <input type="text" id="w-name" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-50 transition-all font-medium" placeholder="Ex: Groupe A - Mathématiques">
                  </div>
                  <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Description</label>
                    <textarea id="w-desc" rows="3" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-50 transition-all font-medium" placeholder="Décrivez le contenu et les objectifs de la classe..."></textarea>
                  </div>
                  <!-- Dynamic Filters Row 1 -->
                  <div>
                      <label class="block text-sm font-bold text-gray-700 mb-2">Catégorie</label>
                      <div class="relative group">
                          <i data-lucide="folder" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 group-focus-within:text-blue-600 transition-colors pointer-events-none"></i>
                          <select id="w-cat" class="w-full pl-12 pr-4 py-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-50 transition-all font-medium text-gray-700 appearance-none cursor-pointer">
                              <option value="">Ex: Langue</option>
                          </select>
                          <i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"></i>
                      </div>
                  </div>

                  <!-- Dynamic Filters Row 2 -->
                  <div class="grid grid-cols-2 gap-4">
                      <!-- Subject -->
                      <div>
                          <label class="block text-sm font-bold text-gray-700 mb-2">Matière</label>
                          <div class="relative group">
                              <i data-lucide="book-open" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 group-focus-within:text-emerald-600 transition-colors pointer-events-none"></i>
                              <select id="w-subject" class="w-full pl-12 pr-4 py-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-emerald-500 focus:ring-4 focus:ring-emerald-50 transition-all font-medium text-gray-700 appearance-none cursor-pointer">
                                  <option value="">Ex: Anglais</option>
                              </select>
                              <i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"></i>
                          </div>
                      </div>

                      <!-- Level -->
                      <div>
                          <label class="block text-sm font-bold text-gray-700 mb-2">Niveau</label>
                          <div class="relative group">
                              <i data-lucide="trending-up" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 group-focus-within:text-amber-600 transition-colors pointer-events-none"></i>
                              <select id="w-lvl" class="w-full pl-12 pr-4 py-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-amber-500 focus:ring-4 focus:ring-amber-50 transition-all font-medium text-gray-700 appearance-none cursor-pointer">
                                  <option value="">Ex: A1.1 - Débutant</option>
                              </select>
                              <i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"></i>
                          </div>
                      </div>
                  </div>

                  <!-- Meeting Link -->
                  <div>
                      <label class="block text-sm font-bold text-gray-700 mb-2">Lien de la réunion</label>
                      <div class="relative">
                          <i data-lucide="video" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                          <input type="url" id="w-meet-link" class="w-full pl-12 pr-4 py-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-50 transition-all font-medium" placeholder="https://meet.google.com/...">
                      </div>
                  </div>

                  <!-- Recordings Folder -->
                  <div>
                      <label class="block text-sm font-bold text-gray-700 mb-2">Dossier Drive des Enregistrements</label>
                      <div class="relative">
                          <i data-lucide="folder-play" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                          <input type="url" id="w-drive-folder" class="w-full pl-12 pr-4 py-4 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-50 transition-all font-medium" placeholder="https://drive.google.com/drive/folders/...">
                      </div>
                      <p class="text-xs text-gray-500 mt-1 ml-1">Lien vers le dossier où vous déposerez les enregistrements.</p>
                  </div>

                  <!-- Pricing Strategy -->
                  <div class="grid grid-cols-2 gap-4">
                      <div>
                          <label class="block text-sm font-bold text-gray-700 mb-2">Type de tarification</label>
                          <select id="w-price-type" onchange="updatePriceLabel(this.value)" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl outline-none font-medium appearance-none cursor-pointer">
                              <option value="monthly">Par Mois</option>
                              <option value="full_course">Forfait Global</option>
                              <option value="hourly">Par Heure</option>
                          </select>
                      </div>
                      <div>
                          <label id="lbl-price" class="block text-sm font-bold text-gray-700 mb-2">Prix Mensuel (TND)</label>
                          <input type="number" id="w-price" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl outline-none font-medium text-lg" placeholder="150">
                      </div>
                  </div>

                  <!-- Schedule Builder -->
                  <div class="border-t border-gray-100 pt-6">
                      <h4 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                          <i data-lucide="calendar" class="w-5 h-5 text-orange-600"></i> Emploi du temps
                      </h4>
                      
                      <div class="bg-orange-50 p-4 rounded-xl border border-orange-100 mb-4">
                          <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                              <select id="sch-day" class="p-3 rounded-lg border border-orange-200 text-sm font-bold text-orange-800 outline-none">
                                  <option value="Lundi">Lundi</option>
                                  <option value="Mardi">Mardi</option>
                                  <option value="Mercredi">Mercredi</option>
                                  <option value="Jeudi">Jeudi</option>
                                  <option value="Vendredi">Vendredi</option>
                                  <option value="Samedi">Samedi</option>
                                  <option value="Dimanche">Dimanche</option>
                              </select>
                              <input type="time" id="sch-start" class="p-3 rounded-lg border border-orange-200 text-sm outline-none">
                              <input type="time" id="sch-end" class="p-3 rounded-lg border border-orange-200 text-sm outline-none">
                              <button onclick="addSession()" class="bg-orange-600 text-white rounded-lg text-sm font-bold hover:bg-orange-700 transition-colors flex items-center justify-center gap-1">
                                  <i data-lucide="plus" class="w-4 h-4"></i> Ajouter
                              </button>
                          </div>
                      </div>
                      
                      <div id="schedule-list" class="space-y-2">
                          <!-- Schedule Items -->
                      </div>
                  </div>

                  <!-- Student Invitations -->
                  <div class="border-t border-gray-100 pt-6">
                      <h4 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                          <i data-lucide="users" class="w-5 h-5 text-green-600"></i> Inviter des étudiants
                      </h4>
                      
                      <div class="flex gap-3 mb-4">
                          <input type="email" id="inv-email" class="flex-1 p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-green-500 transition-all font-medium" placeholder="Email de l'étudiant">
                          <button onclick="addInvite()" class="px-6 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 flex items-center gap-2">
                              <i data-lucide="mail" class="w-4 h-4"></i> Inviter
                          </button>
                      </div>
                      
                      <div id="invites-list" class="flex flex-wrap gap-2">
                          <!-- Invited Tags -->
                      </div>
                  </div>

                  <!-- Resources & Folders Section -->
                  <div id="resources-container" class="border-t border-gray-100 pt-6">
                      <h4 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                          <i data-lucide="folder-open" class="w-5 h-5 text-blue-600"></i> Ressources & Dossiers
                      </h4>
                      
                      <!-- Folder Creation -->
                      <div class="flex gap-3 mb-4">
                          <input type="text" id="fol-name" class="flex-1 p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:bg-white focus:border-blue-500 transition-all font-medium" placeholder="Nouveau Dossier (Ex: Chapitre 1)">
                          <button onclick="addFolder()" class="px-4 bg-gray-200 text-gray-700 rounded-xl font-bold hover:bg-gray-300 flex items-center gap-2">
                              <i data-lucide="folder-plus" class="w-4 h-4"></i> Créer
                          </button>
                      </div>

                      <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 mb-4">
                          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                              <!-- Folder Select -->
                               <select id="res-folder" class="p-3 rounded-lg border border-blue-200 text-sm font-bold text-blue-800 outline-none">
                                  <option value="">(Racine / Aucun Dossier)</option>
                                  <!-- Folders injected here -->
                              </select>
                              <select id="res-type" class="p-3 rounded-lg border border-blue-200 text-sm font-bold text-blue-800 outline-none">
                                  <option value="drive">Google Drive / Video</option>
                                  <option value="pdf">Document PDF</option>
                              </select>
                          </div>
                          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <input type="text" id="res-title" placeholder="Titre (ex: Séance 1)" class="p-3 rounded-lg border border-blue-200 text-sm outline-none">
                              <input type="text" id="res-link" placeholder="Lien URL" class="p-3 rounded-lg border border-blue-200 text-sm outline-none">
                          </div>
                          <button onclick="addResource()" class="w-full mt-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700 transition-colors">Ajouter la ressource</button>
                      </div>
                      
                      <div id="resources-list" class="space-y-4 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar">
                          <!-- Resources List with Folders -->
                      </div>
                  </div>
          </div>

          <div class="p-6 border-t border-gray-100 bg-gray-50 flex justify-end gap-3">
              <button onclick="closeModal()" class="px-6 py-3 font-bold text-gray-500 hover:text-gray-900">Annuler</button>
              <button onclick="finishCreate()" class="px-8 py-3 bg-gray-900 text-white rounded-xl font-bold hover:bg-black shadow-lg shadow-gray-200 transition-all">Enregistrer la Classe</button>
          </div>
      </div>
  </div>

  <script src="../../js/core/data-manager.js"></script>
  <script src="../../js/pages/dynamic-filters.js"></script>
  <script src="../../js/pages/instructor-classes.js?v=3"></script>
  <script src="../../js/components/sidebar-formateur.js?v=2"></script>
</body>
</html>
